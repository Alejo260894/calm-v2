import React, {useEffect, useState} from 'react';import { fetchPurchaseOrders, receivePurchase, fetchSuppliers, fetchWarehouses } from '../api';export default function PurchaseOrders(){ const [pos,setPos]=useState([]); const [selected,setSelected]=useState(null); const [warehouses,setWarehouses]=useState([]); useEffect(()=>{ fetchPurchaseOrders().then(setPos); fetchWarehouses().then(setWarehouses) },[]); async function handleReceivePartial(po){ const items = po.items.map(it=>({ purchase_item_id: it.id, received_quantity: it.quantity - it.received_quantity })); const warehouse_id = warehouses[0]?.id || null; const res = await receivePurchase(po.id, { items, warehouse_id }); alert(JSON.stringify(res)); fetchPurchaseOrders().then(setPos) } return (<div className='bg-white p-4 rounded shadow'><h2 className='text-xl font-semibold mb-4'>Purchase Orders</h2><table className='w-full'><thead><tr><th>ID</th><th>Supplier</th><th>Status</th><th>Total</th><th>Actions</th></tr></thead><tbody>{pos.map(po=> <tr key={po.id}><td>{po.id}</td><td>{po.supplier_name}</td><td>{po.status}</td><td>{po.total_cost}</td><td>{po.status!=='received'&&<button className='btn mr-2' onClick={()=>handleReceivePartial(po)}>Receive all remaining</button>}<button className='btn' onClick={()=>setSelected(po)}>Details</button></td></tr>)}</tbody></table>{selected && <div className='mt-4 bg-gray-50 p-3 rounded'><h3 className='font-semibold'>PO {selected.id} - {selected.supplier_name}</h3><table className='w-full mt-2'><thead><tr><th>SKU</th><th>Product</th><th>Qty</th><th>Received</th></tr></thead><tbody>{selected.items.map(it=> <tr key={it.id}><td>{it.sku}</td><td>{it.product_name}</td><td>{it.quantity}</td><td>{it.received_quantity}</td></tr>)}</tbody></table><button className='btn mt-2' onClick={()=>setSelected(null)}>Close</button></div>}</div>) }
