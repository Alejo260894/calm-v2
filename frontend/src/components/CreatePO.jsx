import React, {useEffect, useState} from 'react';import { fetchProducts, fetchSuppliers, createPurchase } from '../api';export default function CreatePO(){ const [products,setProducts]=useState([]); const [suppliers,setSuppliers]=useState([]); const [supplierId,setSupplierId]=useState(''); const [lines,setLines]=useState([{product_id:'',quantity:1,unit_cost:0}]); useEffect(()=>{ fetchProducts().then(setProducts); fetchSuppliers().then(setSuppliers) },[]); function updateLine(i,k,v){ const next=[...lines]; next[i][k]=v; setLines(next) } function addLine(){ setLines([...lines,{product_id:'',quantity:1,unit_cost:0}]) } async function submit(){ if(!supplierId) return alert('Select supplier'); if(lines.some(l=>!l.product_id||l.quantity<=0)) return alert('Fix lines'); const payload={supplier_id: parseInt(supplierId), items: lines.map(l=>({product_id: parseInt(l.product_id), quantity: parseInt(l.quantity), unit_cost: parseFloat(l.unit_cost)}))}; const res=await createPurchase(payload); alert('PO created: '+res.id); setSupplierId(''); setLines([{product_id:'',quantity:1,unit_cost:0}]) } return (<div className='bg-white p-4 rounded shadow'><h2 className='text-xl font-semibold mb-4'>Create Purchase Order</h2><div className='mb-3'><select className='p-2 border w-full' value={supplierId} onChange={e=>setSupplierId(e.target.value)}><option value=''>Select supplier</option>{suppliers.map(s=> <option key={s.id} value={s.id}>{s.name}</option>)}</select></div>{lines.map((ln,i)=> <div key={i} className='flex gap-2 mb-2'><select className='p-2 border' value={ln.product_id} onChange={e=>updateLine(i,'product_id',e.target.value)}><option value=''>Product</option>{products.map(p=> <option key={p.id} value={p.id}>{p.sku} - {p.name}</option>)}</select><input className='p-2 border w-24' type='number' value={ln.quantity} onChange={e=>updateLine(i,'quantity',e.target.value)} /><input className='p-2 border w-28' type='number' step='0.01' value={ln.unit_cost} onChange={e=>updateLine(i,'unit_cost',e.target.value)} /></div>)}<div className='mt-2'><button className='btn mr-2' onClick={addLine}>Add line</button><button className='btn' onClick={submit}>Create PO</button></div></div>) }
